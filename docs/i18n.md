# Internationalization (i18n) Guide

AI Secretary підтримує три мови: англійську (en), німецьку (de) та українську (uk).

## Підтримувані мови

- **English (en)** - мова за замовчуванням
- **Deutsch (de)** - для німецького ринку
- **Українська (uk)** - для українського ринку

## Використання в коді

### В Python коді

```python
from flask_babel import gettext as _, lazy_gettext as _l

# Для звичайних повідомлень
message = _('Hello, world!')

# Для lazy evaluation (в класах, константах)
ERROR_MESSAGE = _l('Something went wrong')
```

### В API відповідях

```python
from app.utils.response import success_response, error_response

# Успішна відповідь
return success_response(
    message=_('Operation completed successfully'),
    data=result
)

# Помилка
return error_response(
    error_code='VALIDATION_ERROR',
    message=_('Invalid input data')
)
```

### В HTML шаблонах

```html
<h1>{{ _('Welcome to AI Secretary') }}</h1>
<p>{{ _('Your intelligent business assistant') }}</p>
```

## Робота з перекладами

### 1. Витягування повідомлень

```powershell
.\scripts\extract-messages.ps1
```

Це створить файл `messages.pot` з усіма рядками для перекладу.

### 2. Оновлення перекладів

```powershell
# Оновити всі мови
.\scripts\update-translations.ps1

# Оновити конкретну мову
.\scripts\update-translations.ps1 -Language de
```

### 3. Редагування перекладів

Відредагуйте файли `.po` в директоріях:
- `app/translations/de/LC_MESSAGES/messages.po` - німецькі переклади
- `app/translations/uk/LC_MESSAGES/messages.po` - українські переклади

### 4. Компіляція перекладів

```powershell
# Компілювати всі мови
.\scripts\compile-translations.ps1

# Компілювати конкретну мову
.\scripts\compile-translations.ps1 -Language de
```

## Визначення мови користувача

Система визначає мову в такому порядку:

1. **URL параметр**: `?lang=de`
2. **Сесія**: збережена мова в сесії
3. **Профіль користувача**: мова в налаштуваннях
4. **Accept-Language заголовок**: з браузера
5. **За замовчуванням**: англійська

## API для роботи з мовами

### Отримання доступних мов

```http
GET /api/v1/languages
```

Відповідь:
```json
{
  "success": true,
  "message": "Available languages",
  "data": {
    "languages": {
      "en": "English",
      "de": "Deutsch", 
      "uk": "Українська"
    },
    "current": "en"
  }
}
```

### Встановлення мови

```http
POST /api/v1/language
Content-Type: application/json

{
  "language": "de"
}
```

## Локалізація форматів

### Дати та час

```python
from app.utils.i18n import get_localized_date_format, get_localized_datetime_format

date_format = get_localized_date_format()  # %d.%m.%Y для de/uk
datetime_format = get_localized_datetime_format()  # %d.%m.%Y %H:%M для de/uk
```

### Валюта

```python
from app.utils.i18n import format_currency

# Німецький формат: 1.234,56 EUR
# Англійський формат: EUR 1,234.56
formatted = format_currency(1234.56, 'EUR')
```

## Додавання нових рядків

1. Використовуйте `_()` або `_l()` в коді:
```python
message = _('New message to translate')
```

2. Витягніть повідомлення:
```powershell
.\scripts\extract-messages.ps1
```

3. Оновіть переклади:
```powershell
.\scripts\update-translations.ps1
```

4. Відредагуйте `.po` файли та додайте переклади

5. Скомпілюйте:
```powershell
.\scripts\compile-translations.ps1
```

## Контекстні переклади

Для рядків, які можуть мати різні значення в різних контекстах:

```python
# В контексті CRM
_('Lead')  # Лід (потенційний клієнт)

# В контексті металів  
_('Lead')  # Свинець

# Використовуйте контекст
pgettext('CRM', 'Lead')
pgettext('Metal', 'Lead')
```

## Множина

Для мов з складними правилами множини (як українська):

```python
from flask_babel import ngettext

count = 5
message = ngettext(
    'You have %(num)d message',
    'You have %(num)d messages', 
    count
)
```

## Тестування перекладів

```python
def test_translations():
    with app.test_request_context():
        # Встановити німецьку мову
        session['language'] = 'de'
        
        # Перевірити переклад
        message = _('Hello, world!')
        assert message == 'Hallo, Welt!'
```

## Рекомендації

1. **Завжди використовуйте переклади** для користувацьких повідомлень
2. **Не перекладайте технічні терміни** (API keys, error codes)
3. **Використовуйте контекст** для неоднозначних термінів
4. **Тестуйте всі мови** перед релізом
5. **Оновлюйте переклади** при додаванні нових функцій

## Структура файлів

```
app/
├── translations/
│   ├── de/
│   │   └── LC_MESSAGES/
│   │       ├── messages.po    # Німецькі переклади
│   │       └── messages.mo    # Скомпільовані переклади
│   └── uk/
│       └── LC_MESSAGES/
│           ├── messages.po    # Українські переклади
│           └── messages.mo    # Скомпільовані переклади
├── utils/
│   ├── i18n.py               # Утиліти i18n
│   └── response.py           # Відповіді з підтримкою i18n
babel.cfg                     # Конфігурація Babel
messages.pot                  # Шаблон перекладів
```