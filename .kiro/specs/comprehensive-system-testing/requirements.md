# Requirements Document

## Introduction

Данная спецификация описывает комплексное тестирование AI Secretary SaaS платформы с использованием реальных данных компаний. Цель - проверить все функции системы от регистрации нового пользователя до полного жизненного цикла работы с платформой, выявить проблемы и создать планы их исправления.

## Requirements

### Requirement 1

**User Story:** Как тестировщик, я хочу провести полную регистрацию нового пользователя с реальными данными компании, чтобы убедиться в корректности процесса онбординга.

#### Acceptance Criteria

1. WHEN новый пользователь заходит на платформу THEN система SHALL отобразить форму регистрации с полями для email, пароля и данных компании
2. WHEN пользователь вводит валидные данные компании (название, VAT номер, адрес) THEN система SHALL успешно создать аккаунт и tenant
3. WHEN регистрация завершена THEN система SHALL отправить подтверждающий email и активировать trial период
4. WHEN пользователь подтверждает email THEN система SHALL предоставить доступ к dashboard с базовой функциональностью

### Requirement 2

**User Story:** Как тестировщик, я хочу протестировать все API endpoints с реальными данными, чтобы убедиться в корректности работы REST API.

#### Acceptance Criteria

1. WHEN выполняется запрос к /api/v1/auth/login с валидными credentials THEN система SHALL вернуть JWT token и статус 200
2. WHEN выполняется запрос к /api/v1/tenants с валидным token THEN система SHALL вернуть данные tenant с корректными полями
3. WHEN выполняется запрос к /api/v1/crm/contacts с данными реальной компании THEN система SHALL создать контакт и вернуть статус 201
4. WHEN выполняется запрос к /api/v1/kyb/counterparties с VAT номером реальной компании THEN система SHALL выполнить KYB проверку и вернуть результат

### Requirement 3

**User Story:** Как тестировщик, я хочу протестировать CRM функциональность с реальными данными компаний, чтобы убедиться в корректности управления лидами и контактами.

#### Acceptance Criteria

1. WHEN создается новый контакт с данными реальной компании THEN система SHALL сохранить все поля корректно
2. WHEN создается новый лид для контакта THEN система SHALL присвоить лид правильному pipeline и stage
3. WHEN обновляется статус лида THEN система SHALL корректно переместить лид по pipeline
4. WHEN создается задача для лида THEN система SHALL назначить задачу пользователю и установить due date

### Requirement 4

**User Story:** Как тестировщик, я хочу протестировать KYB мониторинг с реальными данными компаний, чтобы убедиться в корректности проверок и алертов.

#### Acceptance Criteria

1. WHEN добавляется counterparty с реальным VAT номером THEN система SHALL выполнить VIES проверку и сохранить результат
2. WHEN добавляется counterparty с реальным LEI кодом THEN система SHALL выполнить GLEIF проверку и получить данные компании
3. WHEN выполняется проверка sanctions списков THEN система SHALL проверить counterparty против всех настроенных списков
4. WHEN обнаруживаются изменения в данных counterparty THEN система SHALL создать alert и отправить уведомление

### Requirement 5

**User Story:** Как тестировщик, я хочу протестировать интеграцию с внешними каналами связи, чтобы убедиться в корректности обработки сообщений.

#### Acceptance Criteria

1. WHEN отправляется сообщение через Telegram webhook THEN система SHALL обработать сообщение и сохранить в inbox
2. WHEN AI обрабатывает входящее сообщение THEN система SHALL определить intent и направить к соответствующему агенту
3. WHEN генерируется ответ от AI агента THEN система SHALL проверить ответ через Supervisor Agent
4. WHEN ответ отправляется обратно THEN система SHALL доставить сообщение через правильный канал

### Requirement 6

**User Story:** Как тестировщик, я хочу протестировать billing и subscription функциональность, чтобы убедиться в корректности работы с платежами.

#### Acceptance Criteria

1. WHEN пользователь выбирает план подписки THEN система SHALL создать Stripe checkout session
2. WHEN платеж успешно обработан THEN система SHALL активировать подписку и обновить entitlements
3. WHEN превышаются лимиты usage THEN система SHALL корректно рассчитать overage charges
4. WHEN подписка отменяется THEN система SHALL деактивировать функции и сохранить данные до конца billing period

### Requirement 7

**User Story:** Как тестировщик, я хочу протестировать календарную интеграцию с Google Calendar, чтобы убедиться в корректности синхронизации событий.

#### Acceptance Criteria

1. WHEN пользователь подключает Google Calendar THEN система SHALL успешно выполнить OAuth авторизацию
2. WHEN создается новое событие через API THEN система SHALL синхронизировать событие с Google Calendar
3. WHEN событие изменяется в Google Calendar THEN система SHALL получить webhook и обновить локальные данные
4. WHEN создается booking через web widget THEN система SHALL создать событие в календаре и отправить приглашения

### Requirement 8

**User Story:** Как тестировщик, я хочу протестировать knowledge management систему, чтобы убедиться в корректности поиска и RAG функциональности.

#### Acceptance Criteria

1. WHEN загружается документ в knowledge base THEN система SHALL обработать документ и создать embeddings
2. WHEN выполняется поиск по knowledge base THEN система SHALL вернуть релевантные результаты
3. WHEN AI агент использует RAG THEN система SHALL найти релевантную информацию и включить в ответ
4. WHEN обновляется документ THEN система SHALL пересоздать embeddings и обновить индекс

### Requirement 9

**User Story:** Как тестировщик, я хочу создать детальные отчеты о найденных проблемах с планами исправления, чтобы обеспечить качество системы.

#### Acceptance Criteria

1. WHEN обнаруживается проблема в функциональности THEN система SHALL зафиксировать детали проблемы в отчете
2. WHEN создается план исправления THEN отчет SHALL содержать приоритет, временные рамки и ответственного
3. WHEN проблема требует действий от пользователя THEN отчет SHALL четко выделить требуемые действия
4. WHEN тестирование завершено THEN система SHALL предоставить сводный отчет со всеми найденными проблемами

### Requirement 10

**User Story:** Как тестировщик, я хочу использовать реальные данные существующих компаний из открытых источников, чтобы обеспечить реалистичность тестирования.

#### Acceptance Criteria

1. WHEN выбираются тестовые данные THEN они SHALL быть взяты из публично доступных источников
2. WHEN используются VAT номера THEN они SHALL быть валидными и проверяемыми через VIES
3. WHEN используются LEI коды THEN они SHALL быть активными в GLEIF базе данных
4. WHEN используются данные компаний THEN они SHALL представлять различные юрисдикции и размеры бизнеса